name: Sync App and Others

on:
  schedule:
    - cron: '0 19 * * *' # 每天北京时间凌晨三点自动运行
  workflow_dispatch:    # 支持手动点击按钮触发

permissions:
  contents: write

jobs:
  sync-folders:
    runs-on: ubuntu-latest
    # 确保不在你自己的原仓库运行，只在别人的 Fork 仓库运行
    if: github.repository != 'ziwenhahaha/daily-paper-reader' 
    steps:
      - name: Checkout User's Repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Config Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Sync Specific Folders from Upstream
        run: |
          # 1. 添加你的原仓库为远程源
          git remote add upstream https://github.com/ziwenhahaha/daily-paper-reader.git
          git fetch upstream main

          # 2. 核心操作：仅从原仓库检出 app 和 others 文件夹
          # 这会覆盖 Fork 仓库中这两个文件夹的内容，但不会动其他文件夹
          git checkout upstream/main -- app/ others/

          # 3. 检查是否有变化并提交
          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "chore: sync app and others folders from upstream"
            git push
          else
            echo "No changes detected in app or others folders."
          fi